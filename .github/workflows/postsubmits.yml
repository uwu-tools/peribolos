name: Postsubmits

on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read

jobs:
  reconcile:
    runs-on: ubuntu-latest
    steps:
      - name: Harden Runner
        uses: step-security/harden-runner@03bee3930647ebbf994244c21ddbc0d4933aab4f # v2.3.0
        with:
          egress-policy: audit # TODO: change to 'egress-policy: block' after couple of runs

      - uses: actions/checkout@8e5e7e5ab8b370d6c329ec480221332ada57f0ab # v3.5.2
      - name: set token
        run: echo ${{ secrets.AUGGIE_BOT_TOKEN }} > token
      - name: peribolos dry-run
        uses: docker://ghcr.io/uwu-tools/peribolos@sha256:3771027ce98f3dcb74b22ce8bcfbde219738fa2cd021fb10c52b42befbcfe08e # v0.0.1
        with:
          github-token-path: ./token
          config-path: config
          fix-org: true
          fix-org-members: true
          fix-teams: true
          fix-team-members: true
          fix-team-repos: true
          min-admins: 3
          #required-admins: # TODO(action): Required admins needs to be configured
